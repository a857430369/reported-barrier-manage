(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43530b8c"],{2532:function(e,t,o){"use strict";var n=o("23e7"),a=o("5a34"),r=o("1d80"),i=o("ab13");n({target:"String",proto:!0,forced:!i("includes")},{includes:function(e){return!!~String(r(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},5864:function(e,t,o){},"5a34":function(e,t,o){var n=o("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},"74fb":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"plan_main"},[o("div",{staticClass:"plan_head"},[o("div",{staticStyle:{"margin-left":"5px","line-height":"21px",float:"left","margin-top":"4px"}},[o("span",[e._v("流程树")]),o("el-button",{staticStyle:{"margin-top":"-2px"},attrs:{size:"mini",type:"primary",plain:""},on:{click:e.revert}},[e._v("返回上一层")])],1),o("div",{staticStyle:{float:"right","line-height":"21px","margin-top":"4px"}},[o("el-button",{staticStyle:{"margin-right":"10px"},attrs:{loading:e.loading.exportData,disabled:e.disableds.exportData,size:"mini",type:"warning",plain:""},on:{click:e.exportData}},[e._v("导出数据")]),o("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block","margin-right":"10px"},attrs:{action:"","http-request":e.uploadData,"show-file-list":!1,"before-upload":e.checkFile,multiple:""}},[o("el-button",{attrs:{size:"mini",type:"primary",disabled:e.disableds.importData,loading:e.loading.importData,plain:""}},[e._v("导入数据")])],1),o("el-button",{attrs:{loading:e.loading.exportModel,disabled:e.disableds.exportModel,size:"mini",type:"success",plain:""},on:{click:e.exportModel}},[e._v("导出模板")]),o("el-button",{attrs:{disabled:e.planDisabled,size:"mini",type:"primary",plain:""},on:{click:function(t){return e.operateFormDialog("fristAdd")}}},[e._v("新增流程")])],1)]),o("div",{staticClass:"plan_body"},[o("el-tree",{staticStyle:{"margin-left":"1px"},attrs:{data:e.treeData,props:e.defaultProps,"default-expand-all":!0,"expand-on-click-node":!1,"render-content":e.renderContent}})],1),o("el-dialog",{attrs:{title:"配置选择人员",visible:e.selectUserDialog,top:"10vh",width:"70%",left:""},on:{"update:visible":function(t){e.selectUserDialog=t}}},[o("div",{staticClass:"wrap"},[o("userSelect",{attrs:{orgClass:"plant_001",treeCode:e.treeCode,modelCode:e.modelCode,nodeCode:e.nodeCode},on:{onCancel:function(t){e.selectUserDialog=!1}}})],1)]),o("el-dialog",{attrs:{title:"edit"==e.operateType?"修改节点":"新增节点",visible:e.showOperateDialog,width:"25%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showOperateDialog=t}}},[o("div",[o("el-form",{ref:"nodeFormRule",staticClass:"dialog-left",attrs:{"label-width":"110px",model:e.nodeForm,rules:e.nodeFormRule}},[o("el-form-item",{attrs:{label:"节点名:",prop:"nodeName"}},[o("el-input",{attrs:{type:"text"},model:{value:e.nodeForm.nodeName,callback:function(t){e.$set(e.nodeForm,"nodeName",t)},expression:"nodeForm.nodeName"}})],1),o("el-form-item",{attrs:{label:"时间限制(小时):",prop:"limitTime"}},[o("el-input",{attrs:{type:"text"},model:{value:e.nodeForm.limitTime,callback:function(t){e.$set(e.nodeForm,"limitTime",t)},expression:"nodeForm.limitTime"}})],1)],1)],1),o("div",{staticStyle:{"text-align":"right"}},[o("el-button",{attrs:{type:"simple"},on:{click:function(t){e.showOperateDialog=!1}}},[e._v("取消")]),o("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.operateFormDate}},[e._v("保存")])],1)])],1)},a=[],r=(o("c975"),o("b0c0"),o("5530")),i=(o("96cf"),o("1da1")),s=o("f956"),l=o("cf45"),d={name:"Plan",components:{userSelect:s["default"]},data:function(){return{operateType:"",treeCode:"",treeData:[],defaultProps:{children:"children",label:"nodeName"},selectUserDialog:!1,showOperateDialog:!1,nodeForm:{nodeCode:null,nodeName:null,limitTime:null,codeLevel:null,parentCode:null},nodeFormRule:{planName:[{required:!0,message:"请输入流程名称",trigger:"blur"}],planDesc:[{required:!0,message:"请输入流程描述",trigger:"blur"}],nodeName:[{required:!0,message:"请输入节点名称",trigger:"blur"}]},loading:{exportModel:!1,exportData:!1,importData:!1},disableds:{exportModel:!1,exportData:!1,importData:!1},modelCode:null,disabled:!1,planDisabled:!1,isCheckNode:!1,nodeCode:null}},mounted:function(){this.modelCode=this.$route.query.code,this.blindTree()},methods:{uploadData:function(e){var t=new FormData;t.append("file",e.file,e.file.name),this.$api.deploy.importTrees(t,this.modelCode).then((function(e){Object(l["a"])(e.data,"提示信息.xls")}))},returnResult:function(e){Object(l["a"])(e.data,"错误人员信息.xls")},checkFile:function(e){var t=e.name;if(-1==t.indexOf(".xls"))return this.$message.error("请导入Excel"),!1},exportModel:function(){var e=this,t={modelCode:this.modelCode};this.loading.exportModel=!0,this.disableds.exportModel=!0,this.$api.deploy.exportTrees(t).then((function(t){e.loading.exportModel=!1,e.disableds.exportModel=!1,Object(l["a"])(t.data,"导出模板.xls")})).catch((function(t){console.error(t),e.loading.exportModel=!1,e.disableds.exportModel=!1,e.$message.error("导出失败")}))},exportData:function(){var e=this,t={modelCode:this.modelCode};this.loading.exportData=!0,this.disableds.exportData=!0,this.$api.deploy.exportTreesData(t).then((function(t){e.loading.exportData=!1,e.disableds.exportData=!1,Object(l["a"])(t.data,"人员数据.xls")})).catch((function(t){console.error(t),e.loading.exportData=!1,e.disableds.exportData=!1,e.$message.error("导出失败")}))},selectUser:function(e){this.treeCode=e.data.code,this.nodeCode=e.data.code,this.selectUserDialog=!0},blindTree:function(){var e=this,t={modelCode:this.modelCode};this.$api.deploy.listNeedTree(t).then((function(t){null===t.content||0===t.content.length?e.planDisabled=!1:e.planDisabled=!0,e.treeData=t.content}))},operateFormDialog:function(e,t){this.operateType=e,"fristAdd"==e?(this.disabled=!1,this.showOperateDialog=!0,this.nodeForm.codeLevel=1,this.nodeForm.nodeCode="",this.nodeForm.nodeName="",this.nodeForm.limitTime="",this.nodeForm.parentCode=null):"add"==e?(this.disabled=!1,this.showOperateDialog=!0,this.nodeForm.nodeCode="",this.nodeForm.nodeName="",this.nodeForm.limitTime="",this.nodeForm.codeLevel=t.codeLevel+1,this.nodeForm.parentCode=t.code):(this.disabled=!1,this.showOperateDialog=!0,this.nodeForm.nodeCode=t.code,this.nodeForm.nodeName=t.nodeName,this.nodeForm.limitTime=t.limitTime,this.nodeForm.codeLevel=t.codeLevel,this.nodeForm.parentCode=t.parentCode)},checkNode:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o={modelCode:e.modelCode,nodeName:e.nodeForm.nodeName},e.isCheckNode=!1,t.next=4,e.$api.deploy.checkNodeName(o).then((function(t){0==t.code&&(e.isCheckNode=t.content)}));case 4:case"end":return t.stop()}}),t)})))()},operateFormDate:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var o,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=!1,e.$refs["nodeFormRule"].validate((function(e){o=e})),o){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e.checkNode();case 6:if(e.isCheckNode){t.next=9;break}return e.$message.error("该节点名称重复了"),t.abrupt("return");case 9:"add"==e.operateType||"fristAdd"==e.operateType?(n=Object(r["a"])({modelCode:e.modelCode},e.nodeForm),e.$api.deploy.insertNeedTree(n).then((function(t){e.$message.success(t.content),e.showOperateDialog=!1,e.blindTree()}))):(a=Object(r["a"])({code:e.nodeForm.nodeCode},e.nodeForm),e.$api.deploy.updateNeedTree(a).then((function(t){e.$message.success(t.content),e.showOperateDialog=!1,e.blindTree()})));case 10:case"end":return t.stop()}}),t)})))()},remove:function(e,t){var o=this;this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={code:t.code,codeLevel:t.codeLevel,modelCode:o.modelCode};o.$api.deploy.deleteNeedTree(e).then((function(e){o.$message.success(e.content),o.blindTree()}))}))},renderContent:function(e,t){var o=this,n=t.node,a=t.data;t.store;return e("span",{style:"flex: 1; display: flex; align-items: center; justify-content: space-between; font-size: 14px; padding-right: 8px;"},[e("span",[e("span",[n.label])]),e("span",[e("el-button",{class:"treeButton",attrs:{type:"primary",plain:!0},on:{click:function(){return o.operateFormDialog("add",a)}}},["增加"]),e("el-button",{class:"treeButton",attrs:{type:"success",plain:!0},on:{click:function(){return o.operateFormDialog("edit",a)}}},["编辑"]),e("el-button",{style:"width: 120px",class:"treeButton",attrs:{type:"primary",plain:!0},on:{click:function(){return o.selectUser(n,a)}}},["选择节点人员"]),e("el-button",{class:"treeButton",attrs:{type:"danger",plain:!0},on:{click:function(){return o.remove(n,a)}}},["删除"])])])},revert:function(){this.$router.go(-1)}}},c=d,u=(o("c171"),o("91c0"),o("2877")),p=Object(u["a"])(c,n,a,!1,null,"0cc79b31",null);t["default"]=p.exports},"91c0":function(e,t,o){"use strict";var n=o("5864"),a=o.n(n);a.a},ab13:function(e,t,o){var n=o("b622"),a=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(o){try{return t[a]=!1,"/./"[e](t)}catch(n){}}return!1}},b2bc:function(e,t,o){},c171:function(e,t,o){"use strict";var n=o("ff94"),a=o.n(n);a.a},c6ba:function(e,t,o){"use strict";var n=o("b2bc"),a=o.n(n);a.a},caad:function(e,t,o){"use strict";var n=o("23e7"),a=o("4d64").includes,r=o("44d2"),i=o("ae40"),s=i("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:!s},{includes:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")},f956:function(e,t,o){"use strict";o.r(t);var n,a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"total-contain"},[o("div",{staticClass:"main-contain"},[o("userSelect",{ref:"childBlack",attrs:{defaultSelectData:e.userList,onlyResult:e.onlyResult,orgClass:e.orgClass},on:{selectPerson:e.selectPerson}})],1),o("div",{staticClass:"footer-contain"},[o("el-button",{staticClass:"footer-button",on:{click:e.cancel}},[e._v("取消")]),o("el-button",{staticClass:"footer-button",attrs:{type:"primary",loading:e.loading},on:{click:e.onSumit}},[e._v("保存")])],1)])},r=[],i=(o("caad"),o("a15b"),o("d81d"),o("2532"),o("ade3")),s=(o("96cf"),o("1da1")),l=o("7642"),d=Object(i["a"])({components:{userSelect:l["default"]},props:{onlyResult:{type:Boolean,default:!1},nodeCode:{type:String,default:""},orgClass:{type:String,default:"plant_001"},modelCode:{type:String,required:!0}},data:function(){return{userList:[],userCodeList:[],isTrue:!1,checkList:[],nameList:[],loading:!1}},methods:(n={selectPerson:function(e,t){this.userCodeList=e,this.nameList=t},cancel:function(){this.$emit("onCancel")}},Object(i["a"])(n,"selectPerson",(function(e){this.userCodeList=e})),Object(i["a"])(n,"checkUser",(function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=e.userCodeList.length){t.next=3;break}return e.$message.error("没有选择人员"),t.abrupt("return");case 3:return o={userCodeList:e.userCodeList,modelCode:e.modelCode,nodeCode:e.nodeCode},e.isTrue=!1,e.checkList=[],t.next=8,e.$api.deploy.checkUser(o).then((function(t){t.content.userCodeList?0==t.content.userCodeList.length?e.isTrue=!0:(e.isTrue=!1,e.checkList=t.content.userCodeList):e.$message.error("系统出错")}));case 8:case"end":return t.stop()}}),t)})))()})),Object(i["a"])(n,"onSumit",(function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.checkUser();case 3:if(e.isTrue){t.next=7;break}return e.checkList.length>0&&(o=[],e.checkList.map((function(t){e.nameList.map((function(e){t!=e.operCode||o.includes(e.userName)||o.push(e.userName)}))})),e.$message.error(o.join("，")+"有节点存在此人员")),e.loading=!1,t.abrupt("return");case 7:n={nodeCode:e.nodeCode,userCodeList:e.userCodeList},e.$api.people.changeNodeAccList(n).then((function(t){0==t.code?(e.loading=!1,e.$message.success("保存成功"),e.cancel()):(e.loading=!1,e.$message.error("保存失败"))})).catch((function(e){console.log(e)}));case 9:case"end":return t.stop()}}),t)})))()})),Object(i["a"])(n,"cancel",(function(){this.$emit("onCancel")})),n),mounted:function(){},watch:{nodeCode:{handler:function(e){var t=this,o={nodeCode:this.nodeCode};this.$api.people.listNodeAccUser(o).then((function(e){0==e.code?(t.userList=e.content,t.nameList=e.content,t.userCodeList=t.userList.map((function(e){return e["operCode"]}))):t.$message.error("查询已选人员错误")})).catch((function(e){console.log(e)}))},immediate:!0}}},"mounted",(function(){})),c=d,u=(o("c6ba"),o("2877")),p=Object(u["a"])(c,a,r,!1,null,"929cb628",null);t["default"]=p.exports},ff94:function(e,t,o){}}]);